<!DOCTYPE html>
<html data-ng-app="lukeburroughs">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0"> 
    	<title>AngularJS Demo</title>
    	<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico" />
		<link rel="stylesheet" type="text/css" href="js/lib/background-slideshow/css/component.css" />
		<link rel="stylesheet" type="text/css" href="css/app.css" />
	</head>
	<body>

		<div id="main" data-ng-controller="mainController">
			<header data-ng-include="'templates/navigation.html'"></header>
			<div data-ng-view></div>
		</div>

		<!-- Scripts -->
		<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="js/lib/modernizr.custom.js"></script>
		<script src="js/lib/background-slideshow/js/jquery.imagesloaded.min.js"></script>
		<script src="js/lib/background-slideshow/js/cbpBGSlideshow.js"></script>

		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular-route.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular-resource.js"></script>
		<script src="config.js"></script>

		<script>

		var app = angular.module('lukeburroughs', ['ngRoute', 'ngResource', 'config']);

		// app.run(function( $rootScope, projects ) {
			// $rootScope.show = function( overlay_name ) {
			// 	$rootScope.overlayPage = overlay_name;
			// }
		// });

		/**
		 * Routing
		 */
		app.config(function( $routeProvider ) {
			$routeProvider
				.when('/', {
					templateUrl: 'templates/index.html'
				})
				.when('/project/:name', {
					controller: 'projectController',
					templateUrl: 'templates/project.html'
				})
				.otherwise({
					redirectTo: '/'
				});
		});

		/**
		 * Pads a number with preceeding zeroes e.g. 5 becomes 005
		 */
		app.filter('padNumber', function() {
			return function pad(input, length) {
				input = input.toString();
				return input.length < length ? pad("0" + input, length) : input;
		    };
		});

		app.factory('Project', function( $resource ) {
			var $r = $resource('projects.json', {}, { 'get': { method: 'GET', isArray: true } });

			$r.getSlide = function( project, slideIndex ) {
				// return project.slides[slideIndex] || null;
				// return $r.get({ id: project.id }).slides;
			}

			return $r;
		});

		app.directive('slideshow', function() {
			return {
				restrict: 'E',
				templateUrl: 'templates/directives/slideshow.html',
				scope: {
					slides: '='
				},
				link: function( scope, element, attrs ) {
					setTimeout(function() {
						cbpBGSlideshow.init();
					}, 0);

					//TODO: Make this less jQuery
					// $(document).on('slide-init slide-change', function( e, slide ) {
					// 	if( slide ) {
					// 		var index = $(slide).data().$scope.$index,
					// 			slide = projects.getSlide($scope.project, index);

					// 		// Set colour values according to current slide config
					// 		$scope.updateColours( slide );
					// 	}
					// });
				}
			}
		});

		app.directive('overlay', function() {
			return {
				restrict: 'E',
				transclude: true,
				templateUrl: 'templates/directives/overlay.html',
				scope: true,
				link: function( scope, element, attrs ) {
					scope.close = function() {
						//TODO: Hide overlay
					}
				}
			}
		});

		app.controller('mainController', function( $scope, Project, HOMEPAGE ) {
			$scope.projects = Project.query();
			$scope.slides = HOMEPAGE.slides;
		});

		app.controller('projectController', function( $scope, $location, $routeParams, Project ) {
			if( $routeParams.name ) {
				$scope.project = Project.get(function() {
					debugger;
				});
					// .error(function() {
					// 	// Redirect back to homepage if the project cannot be found
					// 	if( !$scope.project ) {
					// 		$location.url('/');
					// 	} 
					// });

				console.log( angular.copy($scope.projects) );

				/**
				 * Updates text and background colour according to project or current slide config.
				 * If a slide value is not provided, the project's default colour value (if one has
				 * been specified).
				 *
				 * @param slide (optional) The slide to get the colour config values from
				 */
				// $scope.updateColours = function( slide ) {
				// 	$('body').css({
				// 		'color': (slide && slide.colour) ? slide.colour : $scope.project.colour || 'inherit',
				// 		'background-color': (slide && slide.colour) ? slide.background : $scope.project.background || 'inherit'
				// 	});
				// }

				// //TODO: Replicate with directive? or ng-show toggle
				// $scope.toggleDescription = function( evt ) {
				// 	$(evt.target).siblings('.description').slideToggle();
				// }
			}
		});

		app.controller('navController', function( $scope, $rootScope, $routeParams, Project ) {
			// Listen for route changes as the controller is outside of ng-view
			// $rootScope.$on('$routeChangeSuccess', function( evt, current, previous ) {
			// 	if( $routeParams.name ) {
			// 		// Set the current project based on route argument
			// 		$scope.project = Project.get({ id: $routeParams.name });

			// 		// Expand projects list for project pages
			// 		// By default it will be close on non-project pages but maintain it's open state between routes
			// 		if( !!$scope.project ) {
			// 			$scope.showProjectList = true;
			// 		}

			// 		// Don't show all projects by default for project pages, otherwise show
			// 		$scope.listAllProjects = !$scope.project;
			// 	}
			// });
		});

		</script>
	</body>
</html>